<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.algorizo.erp.inboundmapper">

	<!-- ResultMap 설정 -->
	<resultMap id="inboundresultmap"
		type="co.algorizo.erp.inbound.inboundDTO">
		<id property="in_id" column="in_id" />
		<result property="in_date" column="in_date" />
		<result property="update_date" column="update_date" />
		<result property="in_status" column="in_status" />
		<result property="in_quantity" column="in_quantity" />
		<result property="etc" column="etc" />
		<result property="del" column="del" />
		<association property="product"
			javaType="co.algorizo.erp.product.ProductDTO">
			<id property="p_id" column="p_id" />
			<result property="p_code" column="p_code" />
			<result property="p_name" column="p_name" />
			<result property="p_price" column="p_price" />
			<result property="p_lctg" column="p_lctg"></result>
			<result property="p_mctg" column="p_mctg"></result>
			<result property="p_sctg" column="p_sctg"></result>
		</association>
		<association property="company"
			javaType="co.algorizo.erp.company.CompanyDTO">
			<id property="cp_id" column="cp_id" />
			<result property="cp_name" column="cp_name" />
			<result property="cp_manager" column="cp_manager" />
			<result property="cp_fax" column="cp_fax" />
		</association>
		<association property="member"
			javaType="co.algorizo.erp.register.dto.MemberDTO">
			<id property="m_id" column="m_id" />
			<result property="m_name" column="m_name" />
			<result property="m_email" column="m_email" />
			<result property="m_pno" column="m_pno" />
		</association>
	</resultMap>

	<!-- 전체 입고 조회 -->
	<select id="list" resultMap="inboundresultmap">
		SELECT
		inb.*,
		IFNULL(inb.etc, 'N/A') AS etc,
		inb.in_status AS in_status,
		p.p_id AS p_id,
		p.p_code AS p_code,
		p.p_name AS p_name,
		p.p_price AS p_price,
		c.cp_id AS cp_id,
		c.cp_name AS cp_name,
		c.cp_manager AS cp_manager,
		c.cp_fax AS cp_fax,
		m.m_id AS m_id,
		m.m_name AS m_name,
		m.m_email AS m_email,
		m.m_pno AS m_phone
		FROM inbound inb
		JOIN product p ON inb.product_p_id = p.p_id
		JOIN company c ON inb.company_cp_id = c.cp_id
		JOIN member m ON inb.member_m_id = m.m_id
		WHERE inb.del = 0;
	</select>

	<!-- 입고 상세 조회 -->
	<select id="detail" parameterType="Int"
		resultMap="inboundresultmap">
		SELECT
		inb.*,
		IFNULL(inb.etc, 'N/A') AS etc,
		inb.in_status AS in_status,
		p.p_id AS p_id,
		p.p_code AS p_code,
		p.p_name AS p_name,
		p.p_price AS p_price,
		p.p_sctg AS p_sctg,
		p.p_mctg AS p_mctg,
		p.p_lctg AS p_lctg,
		c.cp_id AS cp_id,
		c.cp_name AS cp_name,
		c.cp_manager AS cp_manager,
		c.cp_fax AS cp_fax,
		m.m_id AS m_id,
		m.m_name AS m_name,
		m.m_email AS m_email,
		m.m_pno AS m_pno
		FROM inbound inb
		JOIN product p ON inb.product_p_id = p.p_id
		JOIN company c ON inb.company_cp_id = c.cp_id
		JOIN member m ON inb.member_m_id = m.m_id
		WHERE inb.in_id = #{in_id};
	</select>

	<!-- 입고 등록 -->
	<insert id="register"
		parameterType="co.algorizo.erp.inbound.inboundDTO">
		INSERT INTO inbound (product_p_id, company_cp_id,
		member_m_id, in_quantity,
		in_status, del)
		VALUES (#{product_p_id},
		#{company_cp_id}, #{member_m_id}, #{in_quantity},
		'입고대기', 0);
	</insert>

	<!-- 입고 수정 -->
	<update id="update"
		parameterType="co.algorizo.erp.inbound.inboundDTO">
		UPDATE inbound SET
		in_status = #{in_status},
		update_date = #{update_date},
		in_quantity = #{in_quantity}
		WHERE in_id = #{in_id};
	</update>

	<!-- 입고 삭제 -->
	<update id="delete" parameterType="Integer">
		UPDATE inbound SET del = 1
		WHERE in_id = #{in_id};
	</update>

</mapper>
